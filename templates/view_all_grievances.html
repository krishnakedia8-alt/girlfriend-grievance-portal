{% extends "base.html" %}
{% block content %}
<h2>All grievances</h2>

<form class="filters" method="get">
  <input name="q" placeholder="Search text" value="{{ q }}">
  <select name="mood">
    <option value="">Any mood</option>
    {% for m in ['ğŸ™‚','ğŸ˜','ğŸ˜•','ğŸ˜¢','ğŸ˜¡'] %}
      <option value="{{ m }}" {% if mood==m %}selected{% endif %}>{{ m }}</option>
    {% endfor %}
  </select>
  <select name="priority">
    <option value="">Any priority</option>
    {% for p in ['Low','Medium','High','Critical'] %}
      <option value="{{ p }}" {% if priority==p %}selected{% endif %}>{{ p }}</option>
    {% endfor %}
  </select>
  <select name="status">
    <option value="">Any status</option>
    <option value="open" {% if status=='open' %}selected{% endif %}>Open</option>
    <option value="closed" {% if status=='closed' %}selected{% endif %}>Closed</option>
  </select>
  <button class="btn">Apply</button>
</form>

<table class="table">
  <thead>
    <tr>
      <th>ID</th><th>Title</th><th>Mood</th><th>Priority</th><th>Status</th><th>Created</th><th>Actions</th>
    </tr>
  </thead>
  <tbody>
  {% for g in grievances %}
    <tr>
      <td>{{ g[0] }}</td>
      <td title="{{ g[2] }}">{{ g[1] }}</td>
      <td>{{ g[3] }}</td>
      <td>{{ g[4] }}</td>
      <td>{{ "Closed" if g[6]==1 else "Open" }}</td>
      <td>{{ g[7] }}</td>
      <td>
        {% if g[6]==0 %}
        <form action="{{ url_for('respond', gid=g[0]) }}" method="post" class="inline">
          <input name="response" placeholder="Type a response" required>
          <button class="btn small">Send</button>
        </form>
        <a class="btn small ghost" href="{{ url_for('resolve', gid=g[0]) }}">Mark resolved</a>
        {% else %}
          <span class="pill">Resolved</span>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
